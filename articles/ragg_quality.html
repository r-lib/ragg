<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ragg Quality • ragg</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Ragg Quality">
<meta property="og:description" content="ragg">
<meta property="og:image" content="https://ragg.r-lib.org/logo.svg">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-115082821-1"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-115082821-1');
</script>
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">ragg</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.3.1.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Benchmarks
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/ragg_quality.html">Quality</a>
    </li>
    <li>
      <a href="../articles/ragg_performance.html">Performance</a>
    </li>
  </ul>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    News
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li class="dropdown-header">Release notes</li>
    <li>
      <a href="https://www.tidyverse.org/articles/2019/07/ragg-0-1-0/">Version 0.1.0</a>
    </li>
    <li class="divider">
    <li>
      <a href="../news/index.html">Change log</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/r-lib/ragg">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="ragg_quality_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Ragg Quality</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/r-lib/ragg/blob/master/vignettes/ragg_quality.Rmd"><code>vignettes/ragg_quality.Rmd</code></a></small>
      <div class="hidden name"><code>ragg_quality.Rmd</code></div>

    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit">
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="kw"><a href="https://ragg.r-lib.org">ragg</a></span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="kw">grid</span>)
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="kw"><a href="https://docs.ropensci.org/magick">magick</a></span>)
<span class="kw">img_zoom</span> <span class="op">&lt;-</span> <span class="fu">function</span>(<span class="kw">path</span>) {
  <span class="kw">img</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://docs.ropensci.org/magick/reference/editing.html">image_read</a></span>(<span class="kw">path</span>)
  <span class="kw">img</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://docs.ropensci.org/magick/reference/transform.html">image_crop</a></span>(<span class="kw">img</span>, <span class="st">'300x150+150+75'</span>)
  <span class="kw">img</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://docs.ropensci.org/magick/reference/transform.html">image_sample</a></span>(<span class="kw">img</span>, <span class="st">'600x300'</span>)
  <span class="kw">img</span>
}
</pre></div>
<p>This vignette tries to compare the quality of the output of ragg, with that of cairo and, if the system supports it, Xlib (Xlib is unix only). As quality is, to a certain extend, subjective, the vignette will be short on conclusions and filled with examples.</p>
<blockquote>
<p>The present version of this vignette has been compiled on a system without the X11 device. The benchmarkings will thus omit this device, though the text will still refer to it.</p>
</blockquote>
<div id="scope" class="section level2">
<h2 class="hasAnchor">
<a href="#scope" class="anchor"></a>Scope</h2>
<p>There are mainly two areas of high importance when discussing graphic device quality: Shape rendering (fill and stroke) and text rendering. Both of these are highly dependent on the quality of anti-aliasing if any. Apart from that we will also look into alpha blending and raster interpolation.</p>
</div>
<div id="shape-rendering" class="section level2">
<h2 class="hasAnchor">
<a href="#shape-rendering" class="anchor"></a>Shape rendering</h2>
<p>The examples here are relevant for rendering of all different types of shapes, be it lines or polygons. Lines obviously don’t have fill, so only the stroke rendering will have relevance here. We chose to use a circle for this as it provides a nice sampling of uneven edges.</p>
<div class="sourceCode" id="cb2"><pre class="downlit">
<span class="kw">circle_quality</span> <span class="op">&lt;-</span> <span class="fu">function</span>(<span class="kw">device</span>, <span class="kw">name</span>, <span class="kw">file</span>, <span class="kw">...</span>) {
  <span class="fu"><a href="https://docs.ropensci.org/magick/reference/device.html">device</a></span>(<span class="kw">file</span>, width = <span class="fl">600</span>, height = <span class="fl">300</span>, <span class="kw">...</span>)
  <span class="fu"><a href="https://rdrr.io/r/grid/grid.circle.html">grid.circle</a></span>(
    x = <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0.25</span>, <span class="fl">0.75</span>), 
    r = <span class="fl">0.4</span>, 
    gp = <span class="fu"><a href="https://rdrr.io/r/grid/gpar.html">gpar</a></span>(col = <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">'black'</span>, <span class="fl">NA</span>), fill = <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">NA</span>, <span class="st">'black'</span>), lwd = <span class="fl">2</span>)
  )
  <span class="fu"><a href="https://rdrr.io/r/grid/grid.text.html">grid.text</a></span>(y = <span class="fl">0.1</span>, label = <span class="kw">name</span>, gp = <span class="fu"><a href="https://rdrr.io/r/grid/gpar.html">gpar</a></span>(cex = <span class="fl">2</span>))
  <span class="fu"><a href="https://rdrr.io/r/base/invisible.html">invisible</a></span>(<span class="fu"><a href="https://rdrr.io/r/grDevices/dev.html">dev.off</a></span>())
}
</pre></div>
<div class="sourceCode" id="cb3"><pre class="downlit">
<span class="kw">ragg_circle</span> <span class="op">&lt;-</span> <span class="kw">knitr</span>::<span class="fu"><a href="https://rdrr.io/pkg/knitr/man/fig_path.html">fig_path</a></span>(<span class="st">'.png'</span>)

<span class="fu">circle_quality</span>(<span class="kw">agg_png</span>, <span class="st">'ragg'</span>, <span class="kw">ragg_circle</span>)

<span class="kw">knitr</span>::<span class="fu"><a href="https://rdrr.io/pkg/knitr/man/include_graphics.html">include_graphics</a></span>(<span class="kw">ragg_circle</span>)
</pre></div>
<p><img src="ragg_quality_files/figure-html/unnamed-chunk-4-1.png"><!-- --></p>
<p><img src="ragg_quality_files/figure-html/unnamed-chunk-5-1.png"><!-- --></p>
<div class="sourceCode" id="cb4"><pre class="downlit">
<span class="kw">cairo_none_circle</span> <span class="op">&lt;-</span> <span class="kw">knitr</span>::<span class="fu"><a href="https://rdrr.io/pkg/knitr/man/fig_path.html">fig_path</a></span>(<span class="st">'.png'</span>)

<span class="fu">circle_quality</span>(<span class="kw">png</span>, <span class="st">'cairo no AA'</span>, <span class="kw">cairo_none_circle</span>, 
               type = <span class="st">'cairo'</span>, antialias = <span class="st">'none'</span>)

<span class="kw">knitr</span>::<span class="fu"><a href="https://rdrr.io/pkg/knitr/man/include_graphics.html">include_graphics</a></span>(<span class="kw">cairo_none_circle</span>)
</pre></div>
<p><img src="ragg_quality_files/figure-html/unnamed-chunk-8-1.png"><!-- --></p>
<p><img src="ragg_quality_files/figure-html/unnamed-chunk-9-1.png"><!-- --></p>
<div class="sourceCode" id="cb5"><pre class="downlit">
<span class="kw">cairo_gray_circle</span> <span class="op">&lt;-</span> <span class="kw">knitr</span>::<span class="fu"><a href="https://rdrr.io/pkg/knitr/man/fig_path.html">fig_path</a></span>(<span class="st">'.png'</span>)

<span class="fu">circle_quality</span>(<span class="kw">png</span>, <span class="st">'cairo gray AA'</span>, <span class="kw">cairo_gray_circle</span>, 
               type = <span class="st">'cairo'</span>, antialias = <span class="st">'gray'</span>)

<span class="kw">knitr</span>::<span class="fu"><a href="https://rdrr.io/pkg/knitr/man/include_graphics.html">include_graphics</a></span>(<span class="kw">cairo_gray_circle</span>)
</pre></div>
<p><img src="ragg_quality_files/figure-html/unnamed-chunk-10-1.png"><!-- --></p>
<p><img src="ragg_quality_files/figure-html/unnamed-chunk-11-1.png"><!-- --></p>
<div class="sourceCode" id="cb6"><pre class="downlit">
<span class="kw">cairo_subpixel_circle</span> <span class="op">&lt;-</span> <span class="kw">knitr</span>::<span class="fu"><a href="https://rdrr.io/pkg/knitr/man/fig_path.html">fig_path</a></span>(<span class="st">'.png'</span>)

<span class="fu">circle_quality</span>(<span class="kw">png</span>, <span class="st">'cairo subpixel AA'</span>, <span class="kw">cairo_subpixel_circle</span>, 
               type = <span class="st">'cairo'</span>, antialias = <span class="st">'subpixel'</span>)

<span class="kw">knitr</span>::<span class="fu"><a href="https://rdrr.io/pkg/knitr/man/include_graphics.html">include_graphics</a></span>(<span class="kw">cairo_subpixel_circle</span>)
</pre></div>
<p><img src="ragg_quality_files/figure-html/unnamed-chunk-12-1.png"><!-- --></p>
<p><img src="ragg_quality_files/figure-html/unnamed-chunk-13-1.png"><!-- --></p>
<div id="observations" class="section level3">
<h3 class="hasAnchor">
<a href="#observations" class="anchor"></a>Observations</h3>
<p>ragg is the only device that provides anti-aliasing of fill, which results in obvious quality differences. The reason for not doing so in cairo is presumably to avoid artefacts when shapes are touching each other where anti-aliasing can result in a thin edge between the two shapes instead of a contiguous colour. This is a real issue, but I personally don’t agree that it should be allowed to degrade the overall quality of the device, hence the reason for not following this approach in ragg.</p>
<p>Xlib (if that is available on your system), provides completely non anti-aliased output and so does cairo with <code>antialias = 'none'</code>. It is surprising that Xlib appears to have a better stroke rendering than cairo without anti-aliasing. Further, the difference between <code>'gray'</code> and <code>'subpixel'</code> antialiasing is not visible to the naked eye, nor with a 2x zoom.</p>
</div>
</div>
<div id="text" class="section level2">
<h2 class="hasAnchor">
<a href="#text" class="anchor"></a>Text</h2>
<p>Text is a difficult thing to handle for a graphic device, both in terms of finding system fonts, and in terms of rendering. Often the rendering is offloaded to another library (e.g. freetype), which will provide a bitmap representation to blend into the device. This approach is often good for horizontal or vertical text, but struggle with other rotations. Here we will test text rendering at different sizes and at a 27° counter-clockwise rotation. We will use the the system provided <em>serif</em> font as it provides a more complex task than a <em>sans-serif</em> one.</p>
<div class="sourceCode" id="cb7"><pre class="downlit">
<span class="kw">text_quality</span> <span class="op">&lt;-</span> <span class="fu">function</span>(<span class="kw">device</span>, <span class="kw">name</span>, <span class="kw">file</span>, <span class="kw">rotation</span> = <span class="fl">0</span>, <span class="kw">...</span>) {
  <span class="kw">text</span> <span class="op">&lt;-</span> <span class="st">'The quick blue R jumped over the lazy snake'</span>
  <span class="kw">vp</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/grid/viewport.html">viewport</a></span>(angle = <span class="kw">rotation</span>)
  <span class="fu"><a href="https://docs.ropensci.org/magick/reference/device.html">device</a></span>(<span class="kw">file</span>, width = <span class="fl">600</span>, height = <span class="fl">300</span>, <span class="kw">...</span>)
  <span class="fu"><a href="https://rdrr.io/r/grid/viewports.html">pushViewport</a></span>(<span class="kw">vp</span>)
  <span class="fu"><a href="https://rdrr.io/r/grid/grid.text.html">grid.text</a></span>(<span class="kw">text</span>, x = <span class="fl">0.1</span>, y = <span class="fl">0.2</span>, just = <span class="st">'left'</span>, gp = <span class="fu"><a href="https://rdrr.io/r/grid/gpar.html">gpar</a></span>(fontfamily = <span class="st">'serif'</span>, cex = <span class="fl">0.5</span>))
  <span class="fu"><a href="https://rdrr.io/r/grid/grid.text.html">grid.text</a></span>(<span class="kw">text</span>, x = <span class="fl">0.1</span>, y = <span class="fl">0.4</span>, just = <span class="st">'left'</span>, gp = <span class="fu"><a href="https://rdrr.io/r/grid/gpar.html">gpar</a></span>(fontfamily = <span class="st">'serif'</span>, cex = <span class="fl">1</span>))
  <span class="fu"><a href="https://rdrr.io/r/grid/grid.text.html">grid.text</a></span>(<span class="kw">text</span>, x = <span class="fl">0.1</span>, y = <span class="fl">0.6</span>, just = <span class="st">'left'</span>, gp = <span class="fu"><a href="https://rdrr.io/r/grid/gpar.html">gpar</a></span>(fontfamily = <span class="st">'serif'</span>, cex = <span class="fl">1.5</span>))
  <span class="fu"><a href="https://rdrr.io/r/grid/grid.text.html">grid.text</a></span>(<span class="kw">text</span>, x = <span class="fl">0.1</span>, y = <span class="fl">0.8</span>, just = <span class="st">'left'</span>, gp = <span class="fu"><a href="https://rdrr.io/r/grid/gpar.html">gpar</a></span>(fontfamily = <span class="st">'serif'</span>, cex = <span class="fl">2</span>))
  <span class="fu"><a href="https://rdrr.io/r/grid/viewports.html">popViewport</a></span>()
  <span class="fu"><a href="https://rdrr.io/r/grid/grid.text.html">grid.text</a></span>(x = <span class="fl">0.9</span>, y = <span class="fl">0.1</span>, label = <span class="kw">name</span>, just = <span class="st">'right'</span>, gp = <span class="fu"><a href="https://rdrr.io/r/grid/gpar.html">gpar</a></span>(cex = <span class="fl">2</span>))
  <span class="fu"><a href="https://rdrr.io/r/base/invisible.html">invisible</a></span>(<span class="fu"><a href="https://rdrr.io/r/grDevices/dev.html">dev.off</a></span>())
}
</pre></div>
<div class="sourceCode" id="cb8"><pre class="downlit">
<span class="kw">ragg_text</span> <span class="op">&lt;-</span> <span class="kw">knitr</span>::<span class="fu"><a href="https://rdrr.io/pkg/knitr/man/fig_path.html">fig_path</a></span>(<span class="st">'.png'</span>)

<span class="fu">text_quality</span>(<span class="kw">agg_png</span>, <span class="st">'ragg'</span>, <span class="kw">ragg_text</span>)

<span class="kw">knitr</span>::<span class="fu"><a href="https://rdrr.io/pkg/knitr/man/include_graphics.html">include_graphics</a></span>(<span class="kw">ragg_text</span>)
</pre></div>
<p><img src="ragg_quality_files/figure-html/unnamed-chunk-15-1.png"><!-- --></p>
<p><img src="ragg_quality_files/figure-html/unnamed-chunk-16-1.png"><!-- --></p>
<div class="sourceCode" id="cb9"><pre class="downlit">
<span class="kw">ragg_text_rot</span> <span class="op">&lt;-</span> <span class="kw">knitr</span>::<span class="fu"><a href="https://rdrr.io/pkg/knitr/man/fig_path.html">fig_path</a></span>(<span class="st">'.png'</span>)

<span class="fu">text_quality</span>(<span class="kw">agg_png</span>, <span class="st">'ragg'</span>, <span class="kw">ragg_text_rot</span>, rotation = <span class="fl">27</span>)

<span class="kw">knitr</span>::<span class="fu"><a href="https://rdrr.io/pkg/knitr/man/include_graphics.html">include_graphics</a></span>(<span class="kw">ragg_text_rot</span>)
</pre></div>
<p><img src="ragg_quality_files/figure-html/unnamed-chunk-17-1.png"><!-- --></p>
<p><img src="ragg_quality_files/figure-html/unnamed-chunk-18-1.png"><!-- --></p>
<div class="sourceCode" id="cb10"><pre class="downlit">
<span class="kw">cairo_none_text</span> <span class="op">&lt;-</span> <span class="kw">knitr</span>::<span class="fu"><a href="https://rdrr.io/pkg/knitr/man/fig_path.html">fig_path</a></span>(<span class="st">'.png'</span>)

<span class="fu">text_quality</span>(<span class="kw">png</span>, <span class="st">'cairo no AA'</span>, <span class="kw">cairo_none_text</span>, 
             type = <span class="st">'cairo'</span>, antialias = <span class="st">'none'</span>)

<span class="kw">knitr</span>::<span class="fu"><a href="https://rdrr.io/pkg/knitr/man/include_graphics.html">include_graphics</a></span>(<span class="kw">cairo_none_text</span>)
</pre></div>
<p><img src="ragg_quality_files/figure-html/unnamed-chunk-23-1.png"><!-- --></p>
<p><img src="ragg_quality_files/figure-html/unnamed-chunk-24-1.png"><!-- --></p>
<div class="sourceCode" id="cb11"><pre class="downlit">
<span class="kw">cairo_none_text_rot</span> <span class="op">&lt;-</span> <span class="kw">knitr</span>::<span class="fu"><a href="https://rdrr.io/pkg/knitr/man/fig_path.html">fig_path</a></span>(<span class="st">'.png'</span>)

<span class="fu">text_quality</span>(<span class="kw">png</span>, <span class="st">'cairo no AA'</span>, <span class="kw">cairo_none_text_rot</span>, rotation = <span class="fl">27</span>, 
             type = <span class="st">'cairo'</span>, antialias = <span class="st">'none'</span>)

<span class="kw">knitr</span>::<span class="fu"><a href="https://rdrr.io/pkg/knitr/man/include_graphics.html">include_graphics</a></span>(<span class="kw">cairo_none_text_rot</span>)
</pre></div>
<p><img src="ragg_quality_files/figure-html/unnamed-chunk-25-1.png"><!-- --></p>
<p><img src="ragg_quality_files/figure-html/unnamed-chunk-26-1.png"><!-- --></p>
<div class="sourceCode" id="cb12"><pre class="downlit">
<span class="kw">cairo_gray_text</span> <span class="op">&lt;-</span> <span class="kw">knitr</span>::<span class="fu"><a href="https://rdrr.io/pkg/knitr/man/fig_path.html">fig_path</a></span>(<span class="st">'.png'</span>)

<span class="fu">text_quality</span>(<span class="kw">png</span>, <span class="st">'cairo gray AA'</span>, <span class="kw">cairo_gray_text</span>, 
             type = <span class="st">'cairo'</span>, antialias = <span class="st">'gray'</span>)

<span class="kw">knitr</span>::<span class="fu"><a href="https://rdrr.io/pkg/knitr/man/include_graphics.html">include_graphics</a></span>(<span class="kw">cairo_gray_text</span>)
</pre></div>
<p><img src="ragg_quality_files/figure-html/unnamed-chunk-27-1.png"><!-- --></p>
<p><img src="ragg_quality_files/figure-html/unnamed-chunk-28-1.png"><!-- --></p>
<div class="sourceCode" id="cb13"><pre class="downlit">
<span class="kw">cairo_gray_text_rot</span> <span class="op">&lt;-</span> <span class="kw">knitr</span>::<span class="fu"><a href="https://rdrr.io/pkg/knitr/man/fig_path.html">fig_path</a></span>(<span class="st">'.png'</span>)

<span class="fu">text_quality</span>(<span class="kw">png</span>, <span class="st">'cairo gray AA'</span>, <span class="kw">cairo_gray_text_rot</span>, rotation = <span class="fl">27</span>, 
             type = <span class="st">'cairo'</span>, antialias = <span class="st">'gray'</span>)

<span class="kw">knitr</span>::<span class="fu"><a href="https://rdrr.io/pkg/knitr/man/include_graphics.html">include_graphics</a></span>(<span class="kw">cairo_gray_text_rot</span>)
</pre></div>
<p><img src="ragg_quality_files/figure-html/unnamed-chunk-29-1.png"><!-- --></p>
<p><img src="ragg_quality_files/figure-html/unnamed-chunk-30-1.png"><!-- --></p>
<div class="sourceCode" id="cb14"><pre class="downlit">
<span class="kw">cairo_subpixel_text</span> <span class="op">&lt;-</span> <span class="kw">knitr</span>::<span class="fu"><a href="https://rdrr.io/pkg/knitr/man/fig_path.html">fig_path</a></span>(<span class="st">'.png'</span>)

<span class="fu">text_quality</span>(<span class="kw">png</span>, <span class="st">'cairo subpixel AA'</span>, <span class="kw">cairo_subpixel_text</span>, 
             type = <span class="st">'cairo'</span>, antialias = <span class="st">'subpixel'</span>)

<span class="kw">knitr</span>::<span class="fu"><a href="https://rdrr.io/pkg/knitr/man/include_graphics.html">include_graphics</a></span>(<span class="kw">cairo_subpixel_text</span>)
</pre></div>
<p><img src="ragg_quality_files/figure-html/unnamed-chunk-31-1.png"><!-- --></p>
<p><img src="ragg_quality_files/figure-html/unnamed-chunk-32-1.png"><!-- --></p>
<div class="sourceCode" id="cb15"><pre class="downlit">
<span class="kw">cairo_subpixel_text_rot</span> <span class="op">&lt;-</span> <span class="kw">knitr</span>::<span class="fu"><a href="https://rdrr.io/pkg/knitr/man/fig_path.html">fig_path</a></span>(<span class="st">'.png'</span>)

<span class="fu">text_quality</span>(<span class="kw">png</span>, <span class="st">'cairo subpixel AA'</span>, <span class="kw">cairo_subpixel_text_rot</span>, rotation = <span class="fl">27</span>, 
             type = <span class="st">'cairo'</span>, antialias = <span class="st">'subpixel'</span>)

<span class="kw">knitr</span>::<span class="fu"><a href="https://rdrr.io/pkg/knitr/man/include_graphics.html">include_graphics</a></span>(<span class="kw">cairo_subpixel_text_rot</span>)
</pre></div>
<p><img src="ragg_quality_files/figure-html/unnamed-chunk-33-1.png"><!-- --></p>
<p><img src="ragg_quality_files/figure-html/unnamed-chunk-34-1.png"><!-- --></p>
<div id="observations-1" class="section level3">
<h3 class="hasAnchor">
<a href="#observations-1" class="anchor"></a>Observations</h3>
<p>Font handling is hard… Setting the font to <code>'serif'</code> means different things to different devices and being more specific results in some devices not being able to find the font. ragg exclusively uses the system fonts so whatever your OS defines as the base serif type it will pick up. Cairo goes through the internal R database to pick a slightly different font. Xlib… well I can’t comment on what it is doing, but it appears to pick something completely different from the X11 system. Regarding quality, I don’t think I have to be mean and mention Xlib, so let’s look at ragg and cairo. Ignoring for a fact that they have used two different fonts, we can see some differences and some interesting stuff. First, cairo don’t care about the anti-alias setting when it renders fonts. My guess is that it will always ask for an 8bit pixelmap from the font engine (probably freetype) and use that. This ensures high quality fonts no matter the settings. The text appears quite heavy, which (unless this is a feature of the font) indicates that cairo does not gamma-correct the pixelmap before blending it into the image. Correct gamma correction of font is quite important, so if that is the case it is quite sad. Another thing we notice is that cairo uses the pixelmaps even for rotated text. This result in jagged baseline and uneven kerning when plotting rotated text. ragg only uses pixelmaps when plotting axis-aligned text. For rotated text it will convert the glyphs to polygons and render them using the built-in rasterizer ensuring an even baseline and kerning. This means plotting rotated text is slightly less performant, at the cost of looking good — I can live with that trade-off.</p>
</div>
</div>
<div id="alpha-blending" class="section level2">
<h2 class="hasAnchor">
<a href="#alpha-blending" class="anchor"></a>Alpha blending</h2>
<p>How transparent colours are combined is not necessarily equal among devices. The biggest divide is on whether to use premultiplied colours or not. With premultiplied colours the red, green, and blue intensity is wieghted by the alpha directly, instead of alpha simply being an additional value. Using premultiplied colours is the only way to get correct alpha blending. As the Xlib device doesn’t support transparent colours it will be exempt from this comparison even on systems that have it. Further, as alpha blending is not related to anti-aliasing, we will simply compare ragg against a single cairo setup.</p>
<div class="sourceCode" id="cb16"><pre class="downlit">
<span class="kw">blend_quality</span> <span class="op">&lt;-</span> <span class="fu">function</span>(<span class="kw">device</span>, <span class="kw">name</span>, <span class="kw">file</span>, <span class="kw">...</span>) {
  <span class="fu"><a href="https://docs.ropensci.org/magick/reference/device.html">device</a></span>(<span class="kw">file</span>, width = <span class="fl">600</span>, height = <span class="fl">300</span>, <span class="kw">...</span>)
  <span class="fu"><a href="https://rdrr.io/r/grid/grid.rect.html">grid.rect</a></span>(x = <span class="fl">0.35</span>, y = <span class="fl">0.4</span>, width = <span class="fl">0.5</span>, height = <span class="fl">0.5</span>, gp = <span class="fu"><a href="https://rdrr.io/r/grid/gpar.html">gpar</a></span>(fill = <span class="st">'#FF0000'</span>))
  <span class="fu"><a href="https://rdrr.io/r/grid/grid.rect.html">grid.rect</a></span>(x = <span class="fl">0.65</span>, y = <span class="fl">0.6</span>, width = <span class="fl">0.5</span>, height = <span class="fl">0.5</span>, gp = <span class="fu"><a href="https://rdrr.io/r/grid/gpar.html">gpar</a></span>(fill = <span class="st">'#00FF001A'</span>))
  <span class="fu"><a href="https://rdrr.io/r/grid/grid.text.html">grid.text</a></span>(x = <span class="fl">0.9</span>, y = <span class="fl">0.1</span>, label = <span class="kw">name</span>, just = <span class="st">'right'</span>, gp = <span class="fu"><a href="https://rdrr.io/r/grid/gpar.html">gpar</a></span>(cex = <span class="fl">2</span>))
  <span class="fu"><a href="https://rdrr.io/r/base/invisible.html">invisible</a></span>(<span class="fu"><a href="https://rdrr.io/r/grDevices/dev.html">dev.off</a></span>())
}
</pre></div>
<div class="sourceCode" id="cb17"><pre class="downlit">
<span class="kw">ragg_blend</span> <span class="op">&lt;-</span> <span class="kw">knitr</span>::<span class="fu"><a href="https://rdrr.io/pkg/knitr/man/fig_path.html">fig_path</a></span>(<span class="st">'.png'</span>)

<span class="fu">blend_quality</span>(<span class="kw">agg_png</span>, <span class="st">'ragg'</span>, <span class="kw">ragg_blend</span>)

<span class="kw">knitr</span>::<span class="fu"><a href="https://rdrr.io/pkg/knitr/man/include_graphics.html">include_graphics</a></span>(<span class="kw">ragg_blend</span>)
</pre></div>
<p><img src="ragg_quality_files/figure-html/unnamed-chunk-36-1.png"><!-- --></p>
<div class="sourceCode" id="cb18"><pre class="downlit">
<span class="kw">cairo_blend</span> <span class="op">&lt;-</span> <span class="kw">knitr</span>::<span class="fu"><a href="https://rdrr.io/pkg/knitr/man/fig_path.html">fig_path</a></span>(<span class="st">'.png'</span>)

<span class="fu">blend_quality</span>(<span class="kw">png</span>, <span class="st">'cairo'</span>, <span class="kw">cairo_blend</span>, type = <span class="st">'cairo'</span>)

<span class="kw">knitr</span>::<span class="fu"><a href="https://rdrr.io/pkg/knitr/man/include_graphics.html">include_graphics</a></span>(<span class="kw">cairo_blend</span>)
</pre></div>
<p><img src="ragg_quality_files/figure-html/unnamed-chunk-37-1.png"><!-- --></p>
<div id="observations-2" class="section level3">
<h3 class="hasAnchor">
<a href="#observations-2" class="anchor"></a>Observations</h3>
<p>Nothing much to say — both devices handles alpha blending correctly (see <a href="https://developer.nvidia.com/content/alpha-blending-pre-or-not-pre">here</a> to understand what this test was about)</p>
</div>
</div>
<div id="raster" class="section level2">
<h2 class="hasAnchor">
<a href="#raster" class="anchor"></a>Raster</h2>
<p>The main way raster plotting can get influence by the device is in how the image gets interpolated during scaling, which will be briefly compared here.</p>
<div class="sourceCode" id="cb19"><pre class="downlit">
<span class="kw">raster_quality</span> <span class="op">&lt;-</span> <span class="fu">function</span>(<span class="kw">device</span>, <span class="kw">name</span>, <span class="kw">file</span>, <span class="kw">...</span>) {
  <span class="kw">reds</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html">matrix</a></span>(<span class="fu"><a href="https://rdrr.io/r/grDevices/hcl.html">hcl</a></span>(<span class="fl">0</span>, <span class="fl">80</span>, <span class="fu"><a href="https://rdrr.io/r/base/seq.html">seq</a></span>(<span class="fl">50</span>, <span class="fl">80</span>, <span class="fl">10</span>)),
                        nrow = <span class="fl">4</span>, ncol = <span class="fl">5</span>)
  <span class="fu"><a href="https://docs.ropensci.org/magick/reference/device.html">device</a></span>(<span class="kw">file</span>, width = <span class="fl">600</span>, height = <span class="fl">300</span>, <span class="kw">...</span>)
  <span class="fu"><a href="https://rdrr.io/r/grid/grid.raster.html">grid.raster</a></span>(<span class="kw">reds</span>, vp = <span class="fu"><a href="https://rdrr.io/r/grid/viewport.html">viewport</a></span>(<span class="fl">0.25</span>, <span class="fl">0.25</span>, <span class="fl">0.5</span>, <span class="fl">0.5</span>, angle = <span class="fl">27</span>))
  <span class="fu"><a href="https://rdrr.io/r/grid/grid.raster.html">grid.raster</a></span>(<span class="kw">reds</span>, interpolate = <span class="fl">FALSE</span>, 
              vp = <span class="fu"><a href="https://rdrr.io/r/grid/viewport.html">viewport</a></span>(<span class="fl">0.75</span>, <span class="fl">0.75</span>, <span class="fl">0.5</span>, <span class="fl">0.5</span>, angle = <span class="fl">27</span>))
  <span class="fu"><a href="https://rdrr.io/r/grid/grid.text.html">grid.text</a></span>(x = <span class="fl">0.9</span>, y = <span class="fl">0.1</span>, label = <span class="kw">name</span>, just = <span class="st">'right'</span>, gp = <span class="fu"><a href="https://rdrr.io/r/grid/gpar.html">gpar</a></span>(cex = <span class="fl">2</span>))
  <span class="fu"><a href="https://rdrr.io/r/base/invisible.html">invisible</a></span>(<span class="fu"><a href="https://rdrr.io/r/grDevices/dev.html">dev.off</a></span>())
}
</pre></div>
<div class="sourceCode" id="cb20"><pre class="downlit">
<span class="kw">ragg_raster</span> <span class="op">&lt;-</span> <span class="kw">knitr</span>::<span class="fu"><a href="https://rdrr.io/pkg/knitr/man/fig_path.html">fig_path</a></span>(<span class="st">'.png'</span>)

<span class="fu">raster_quality</span>(<span class="kw">agg_png</span>, <span class="st">'ragg'</span>, <span class="kw">ragg_raster</span>)

<span class="kw">knitr</span>::<span class="fu"><a href="https://rdrr.io/pkg/knitr/man/include_graphics.html">include_graphics</a></span>(<span class="kw">ragg_raster</span>)
</pre></div>
<p><img src="ragg_quality_files/figure-html/unnamed-chunk-39-1.png"><!-- --></p>
<div class="sourceCode" id="cb21"><pre class="downlit">
<span class="kw">cairo_raster</span> <span class="op">&lt;-</span> <span class="kw">knitr</span>::<span class="fu"><a href="https://rdrr.io/pkg/knitr/man/fig_path.html">fig_path</a></span>(<span class="st">'.png'</span>)

<span class="fu">raster_quality</span>(<span class="kw">png</span>, <span class="st">'cairo'</span>, <span class="kw">cairo_raster</span>, type = <span class="st">'cairo'</span>)

<span class="kw">knitr</span>::<span class="fu"><a href="https://rdrr.io/pkg/knitr/man/include_graphics.html">include_graphics</a></span>(<span class="kw">cairo_raster</span>)
</pre></div>
<p><img src="ragg_quality_files/figure-html/unnamed-chunk-41-1.png"><!-- --></p>
<div id="observations-3" class="section level3">
<h3 class="hasAnchor">
<a href="#observations-3" class="anchor"></a>Observations</h3>
<p>As with blending there is nothing much to see here. All devices perform equally and correctly.</p>
</div>
</div>
<div id="conclusion" class="section level2">
<h2 class="hasAnchor">
<a href="#conclusion" class="anchor"></a>Conclusion</h2>
<p>When it comes to raster quality there is only really the two contenders are obviously ragg and anti-aliased cairo, as lack of anti-aliasing has clear detrimental effect on output quality. As there appear to be no real difference in quality between cairo’s two anti-aliasing modes the question basically boils down to cairo vs ragg. While for the most part the two rendering systems provide comparable output, there are two areas where ragg takes the lead, quality-wise: rendering of fill, and rendering of rotated text. If these areas are of interest to you then ragg will be the obvious choice.</p>
</div>
<div id="session-info" class="section level2">
<h2 class="hasAnchor">
<a href="#session-info" class="anchor"></a>Session info</h2>
<div class="sourceCode" id="cb22"><pre class="downlit">
<span class="kw">sessioninfo</span>::<span class="fu"><a href="https://rdrr.io/pkg/sessioninfo/man/session_info.html">session_info</a></span>()
<span class="co">#&gt; ─ Session info ───────────────────────────────────────────────────────────────</span>
<span class="co">#&gt;  setting  value                       </span>
<span class="co">#&gt;  version  R version 4.0.2 (2020-06-22)</span>
<span class="co">#&gt;  os       macOS Catalina 10.15.5      </span>
<span class="co">#&gt;  system   x86_64, darwin17.0          </span>
<span class="co">#&gt;  ui       X11                         </span>
<span class="co">#&gt;  language (EN)                        </span>
<span class="co">#&gt;  collate  en_US.UTF-8                 </span>
<span class="co">#&gt;  ctype    en_US.UTF-8                 </span>
<span class="co">#&gt;  tz       UTC                         </span>
<span class="co">#&gt;  date     2020-07-03                  </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; ─ Packages ───────────────────────────────────────────────────────────────────</span>
<span class="co">#&gt;  package     * version    date       lib source                            </span>
<span class="co">#&gt;  assertthat    0.2.1      2019-03-21 [1] CRAN (R 4.0.0)                    </span>
<span class="co">#&gt;  backports     1.1.8      2020-06-17 [1] CRAN (R 4.0.0)                    </span>
<span class="co">#&gt;  cli           2.0.2      2020-02-28 [1] CRAN (R 4.0.0)                    </span>
<span class="co">#&gt;  crayon        1.3.4      2017-09-16 [1] CRAN (R 4.0.0)                    </span>
<span class="co">#&gt;  desc          1.2.0      2018-05-01 [1] CRAN (R 4.0.0)                    </span>
<span class="co">#&gt;  digest        0.6.25     2020-02-23 [1] CRAN (R 4.0.0)                    </span>
<span class="co">#&gt;  evaluate      0.14       2019-05-28 [1] CRAN (R 4.0.0)                    </span>
<span class="co">#&gt;  fansi         0.4.1      2020-01-08 [1] CRAN (R 4.0.0)                    </span>
<span class="co">#&gt;  fs            1.4.2      2020-06-30 [1] CRAN (R 4.0.2)                    </span>
<span class="co">#&gt;  glue          1.4.1      2020-05-13 [1] CRAN (R 4.0.0)                    </span>
<span class="co">#&gt;  htmltools     0.5.0      2020-06-16 [1] CRAN (R 4.0.0)                    </span>
<span class="co">#&gt;  knitr         1.29       2020-06-23 [1] CRAN (R 4.0.0)                    </span>
<span class="co">#&gt;  magick      * 2.4.0      2020-06-23 [1] CRAN (R 4.0.0)                    </span>
<span class="co">#&gt;  magrittr      1.5        2014-11-22 [1] CRAN (R 4.0.0)                    </span>
<span class="co">#&gt;  memoise       1.1.0      2017-04-21 [1] CRAN (R 4.0.0)                    </span>
<span class="co">#&gt;  pkgdown       1.5.1.9000 2020-07-03 [1] Github (r-lib/pkgdown@caf7cc7)    </span>
<span class="co">#&gt;  R6            2.4.1      2019-11-12 [1] CRAN (R 4.0.0)                    </span>
<span class="co">#&gt;  ragg        * 0.3.1.9000 2020-07-03 [1] local                             </span>
<span class="co">#&gt;  Rcpp          1.0.4.6    2020-04-09 [1] CRAN (R 4.0.0)                    </span>
<span class="co">#&gt;  rlang         0.4.6      2020-05-02 [1] CRAN (R 4.0.0)                    </span>
<span class="co">#&gt;  rmarkdown     2.3.2      2020-07-03 [1] Github (rstudio/rmarkdown@fe610c0)</span>
<span class="co">#&gt;  rprojroot     1.3-2      2018-01-03 [1] CRAN (R 4.0.0)                    </span>
<span class="co">#&gt;  sessioninfo   1.1.1      2018-11-05 [1] CRAN (R 4.0.0)                    </span>
<span class="co">#&gt;  stringi       1.4.6      2020-02-17 [1] CRAN (R 4.0.0)                    </span>
<span class="co">#&gt;  stringr       1.4.0      2019-02-10 [1] CRAN (R 4.0.0)                    </span>
<span class="co">#&gt;  systemfonts   0.2.3      2020-06-09 [1] CRAN (R 4.0.0)                    </span>
<span class="co">#&gt;  withr         2.2.0      2020-04-20 [1] CRAN (R 4.0.0)                    </span>
<span class="co">#&gt;  xfun          0.15       2020-06-21 [1] CRAN (R 4.0.0)                    </span>
<span class="co">#&gt;  yaml          2.2.1      2020-02-01 [1] CRAN (R 4.0.0)                    </span>
<span class="co">#&gt; </span>
<span class="co">#&gt; [1] /Users/runner/runners/2.263.0/work/_temp/Library</span>
<span class="co">#&gt; [2] /Library/Frameworks/R.framework/Versions/4.0/Resources/library</span>
</pre></div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by <a href="https://data-imaginist.com">Thomas Lin Pedersen</a>, Maxim Shemanarev.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.9000.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
